<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã¨ã‚¤ãƒŸæ—¥è¨˜ - ç ”ç©¶è€…å‘ã‘åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .analysis-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            background: #3498db;
            color: white;
            cursor: pointer;
            border: none;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .results {
            background: white;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            margin-top: 15px;
        }
        
        .metric {
            display: inline-block;
            margin: 10px 15px 10px 0;
            padding: 10px 15px;
            background: #ecf0f1;
            border-radius: 5px;
            border-left: 3px solid #e74c3c;
        }
        
        .metric-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-value {
            font-size: 1.2em;
            color: #e74c3c;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .loading {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ ã“ã¨ã‚¤ãƒŸæ—¥è¨˜ - ç ”ç©¶åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p>æ„å‘³ã¥ã‘ã®å¤šæ§˜æ€§ã¨èªçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã™ã‚‹ãŸã‚ã®ç ”ç©¶ãƒ„ãƒ¼ãƒ«</p>
        
        <!-- å¤šæ§˜æ€§æŒ‡æ¨™åˆ†æ -->
        <div class="analysis-section">
            <h2>ğŸ“Š æ„å‘³ã¥ã‘ã®å¤šæ§˜æ€§åˆ†æ</h2>
            <div class="controls">
                <select id="diversity-event-tag">
                    <option value="">å…¨ä½“çµ±è¨ˆ</option>
                    <option value="work_late">é…åˆ»ã—ãŸ</option>
                    <option value="work_praised">è¤’ã‚ã‚‰ã‚ŒãŸ</option>
                    <option value="work_failed">ä»•äº‹ã§å¤±æ•—ã—ãŸ</option>
                    <option value="relationship_fight">ã‚±ãƒ³ã‚«ã—ãŸ</option>
                    <option value="weather_rain">é›¨ã«é™ã‚‰ã‚ŒãŸ</option>
                    <option value="accident_minor">è»½ã„äº‹æ•…</option>
                    <option value="achievement_goal">ç›®æ¨™é”æˆ</option>
                </select>
                <button onclick="analyzeDiversity()">å¤šæ§˜æ€§åˆ†æå®Ÿè¡Œ</button>
            </div>
            <div id="diversity-results" class="results" style="display: none;">
                <div id="diversity-metrics"></div>
                <pre id="diversity-json"></pre>
            </div>
        </div>
        
        <!-- èªçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ -->
        <div class="analysis-section">
            <h2>âš–ï¸ åˆ©ç”¨ãƒ¢ãƒ¼ãƒ‰åˆ¥èªçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ</h2>
            <div class="controls">
                <select id="mode-event-tag">
                    <option value="">å…¨ä½“æ¯”è¼ƒ</option>
                    <option value="work_late">é…åˆ»ã—ãŸ</option>
                    <option value="work_praised">è¤’ã‚ã‚‰ã‚ŒãŸ</option>
                    <option value="weather_rain">é›¨ã«é™ã‚‰ã‚ŒãŸ</option>
                </select>
                <button onclick="analyzeModeComparison()">ãƒ¢ãƒ¼ãƒ‰æ¯”è¼ƒå®Ÿè¡Œ</button>
            </div>
            <div id="mode-results" class="results" style="display: none;">
                <div id="mode-metrics"></div>
                <pre id="mode-json"></pre>
            </div>
        </div>
        
        <!-- æ„å‘³ã¥ã‘ã®å¤‰åŒ–åˆ†æ -->
        <div class="analysis-section">
            <h2>ğŸ”„ ç¤¾ä¼šçš„æƒ…å ±æç¤ºã«ã‚ˆã‚‹èªçŸ¥å¤‰åŒ–åˆ†æ</h2>
            <div class="controls">
                <select id="revision-event-tag">
                    <option value="">å…¨ä½“çµ±è¨ˆ</option>
                    <option value="work_late">é…åˆ»ã—ãŸ</option>
                    <option value="relationship_fight">ã‚±ãƒ³ã‚«ã—ãŸ</option>
                </select>
                <button onclick="analyzeRevisionImpact()">å¤‰åŒ–åˆ†æå®Ÿè¡Œ</button>
            </div>
            <div id="revision-results" class="results" style="display: none;">
                <div id="revision-metrics"></div>
                <pre id="revision-json"></pre>
            </div>
        </div>
        
        <!-- åŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆ -->
        <div class="analysis-section">
            <h2>ğŸ“ˆ åŒ…æ‹¬çš„åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h2>
            <div class="controls">
                <button onclick="generateComprehensiveReport()">åŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
            </div>
            <div id="comprehensive-results" class="results" style="display: none;">
                <pre id="comprehensive-json"></pre>
            </div>
        </div>
    </div>

    <script>
        // APIè¨­å®š - Railway ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«URLã‚’æ›´æ–°
        const API_BASE_URL = window.location.hostname === 'kotoimidiary.netlify.app' 
            ? 'https://imizuke-production.up.railway.app'  // Railway URL
            : '';  // ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã¯ç›¸å¯¾ãƒ‘ã‚¹

        async function callResearchAPI(type, eventTag = null) {
            const url = new URL('/api/analysis', API_BASE_URL || window.location.origin);
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
        }
        
        function showMetrics(containerId, data) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (data.entropy_text !== undefined) {
                container.innerHTML += `
                    <div class="metric">
                        <div class="metric-label">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ H(E) - ãƒ†ã‚­ã‚¹ãƒˆ</div>
                        <div class="metric-value">${data.entropy_text.toFixed(3)}</div>
                    </div>
                `;
            }
            
            if (data.entropy_tags !== undefined) {
                container.innerHTML += `
                    <div class="metric">
                        <div class="metric-label">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ H(E) - ã‚¿ã‚°</div>
                        <div class="metric-value">${data.entropy_tags.toFixed(3)}</div>
                    </div>
                `;
            }
            
            if (data.semantic_distance_avg !== undefined) {
                container.innerHTML += `
                    <div class="metric">
                        <div class="metric-label">æ„å‘³è·é›¢å¹³å‡</div>
                        <div class="metric-value">${data.semantic_distance_avg.toFixed(3)}</div>
                    </div>
                `;
            }
            
            if (data.consensus_rate !== undefined) {
                container.innerHTML += `
                    <div class="metric">
                        <div class="metric-label">åˆæ„ç‡ max p(M_i|E)</div>
                        <div class="metric-value">${(data.consensus_rate * 100).toFixed(1)}%</div>
                    </div>
                `;
            }
            
            if (data.total_entries !== undefined) {
                container.innerHTML += `
                    <div class="metric">
                        <div class="metric-label">ãƒ‡ãƒ¼ã‚¿æ•°</div>
                        <div class="metric-value">${data.total_entries}</div>
                    </div>
                `;
            }
        }
        
        async function analyzeDiversity() {
            const eventTag = document.getElementById('diversity-event-tag').value || null;
            const resultsDiv = document.getElementById('diversity-results');
            const metricsDiv = document.getElementById('diversity-metrics');
            const jsonPre = document.getElementById('diversity-json');
            
            try {
                resultsDiv.style.display = 'block';
                metricsDiv.innerHTML = '<div class="loading">åˆ†æä¸­...</div>';
                jsonPre.textContent = '';
                
                const data = await callResearchAPI('diversity', eventTag);
                
                showMetrics('diversity-metrics', data);
                jsonPre.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                metricsDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                jsonPre.textContent = '';
            }
        }
        
        async function analyzeModeComparison() {
            const eventTag = document.getElementById('mode-event-tag').value || null;
            const resultsDiv = document.getElementById('mode-results');
            const metricsDiv = document.getElementById('mode-metrics');
            const jsonPre = document.getElementById('mode-json');
            
            try {
                resultsDiv.style.display = 'block';
                metricsDiv.innerHTML = '<div class="loading">åˆ†æä¸­...</div>';
                jsonPre.textContent = '';
                
                const data = await callResearchAPI('mode_comparison', eventTag);
                
                // Solo/Socialæ¯”è¼ƒãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º
                metricsDiv.innerHTML = `
                    <h4>Solo ãƒ¢ãƒ¼ãƒ‰</h4>
                    <div style="margin-left: 20px;">
                        <div class="metric">
                            <div class="metric-label">ãƒ‡ãƒ¼ã‚¿æ•°</div>
                            <div class="metric-value">${data.solo.count}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼(ãƒ†ã‚­ã‚¹ãƒˆ)</div>
                            <div class="metric-value">${data.solo.entropy_text.toFixed(3)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">åˆæ„ç‡</div>
                            <div class="metric-value">${(data.solo.consensus_rate * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                    
                    <h4>Social ãƒ¢ãƒ¼ãƒ‰</h4>
                    <div style="margin-left: 20px;">
                        <div class="metric">
                            <div class="metric-label">ãƒ‡ãƒ¼ã‚¿æ•°</div>
                            <div class="metric-value">${data.social.count}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼(ãƒ†ã‚­ã‚¹ãƒˆ)</div>
                            <div class="metric-value">${data.social.entropy_text.toFixed(3)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">åˆæ„ç‡</div>
                            <div class="metric-value">${(data.social.consensus_rate * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                    
                    <h4>å·®åˆ†</h4>
                    <div style="margin-left: 20px;">
                        <div class="metric">
                            <div class="metric-label">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼å·®åˆ†</div>
                            <div class="metric-value">${data.differences.entropy_text_diff.toFixed(3)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">åˆæ„ç‡å·®åˆ†</div>
                            <div class="metric-value">${(data.differences.consensus_rate_diff * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                `;
                
                jsonPre.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                metricsDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                jsonPre.textContent = '';
            }
        }
        
        async function analyzeRevisionImpact() {
            const eventTag = document.getElementById('revision-event-tag').value || null;
            const resultsDiv = document.getElementById('revision-results');
            const metricsDiv = document.getElementById('revision-metrics');
            const jsonPre = document.getElementById('revision-json');
            
            try {
                resultsDiv.style.display = 'block';
                metricsDiv.innerHTML = '<div class="loading">åˆ†æä¸­...</div>';
                jsonPre.textContent = '';
                
                const data = await callResearchAPI('revision_impact', eventTag);
                
                metricsDiv.innerHTML = `
                    <div class="metric">
                        <div class="metric-label">ä»–è€…ãƒ‡ãƒ¼ã‚¿é–²è¦§è€…æ•°</div>
                        <div class="metric-value">${data.total_saw_alt_meanings}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ä¿®æ­£è€…æ•°</div>
                        <div class="metric-value">${data.changed_after_view_count}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ä¿®æ­£ç‡</div>
                        <div class="metric-value">${(data.change_rate * 100).toFixed(1)}%</div>
                    </div>
                `;
                
                jsonPre.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                metricsDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                jsonPre.textContent = '';
            }
        }
        
        async function generateComprehensiveReport() {
            const resultsDiv = document.getElementById('comprehensive-results');
            const jsonPre = document.getElementById('comprehensive-json');
            
            try {
                resultsDiv.style.display = 'block';
                jsonPre.textContent = 'åŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­...';
                
                const data = await callResearchAPI('comprehensive');
                jsonPre.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                jsonPre.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
    </script>
</body>
</html>